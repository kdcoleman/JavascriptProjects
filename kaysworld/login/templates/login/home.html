{% load static %}
{% load tz %}

<html lang="en-US">
  <head>
    <title> Kay's World</title>
    <meta name="description" content="A demonstration of login authentication.">
    <link href="{% static 'login/style.css' %}" type="text/css" rel="stylesheet">
  </head>

  <!-- BODY CONTENT -->
  <body onload="showWelcomeMessage(); resetTimer()">
    <div class="container">

      <header>
        <h1>Kay's World</h1>
        <div class="rightside">
          <a id="signupLink" class="head" href="{% url 'login:home' user.id %}">Activity</a>
          <a id="logoutLink" class="head" href="{% url 'login:index' %}">Logout</a>
      </div>
      </header>

      <div class="section">
        <img src="{% static 'login/images/lakhtaCenter.jpg' %}">
      </div>

      <div id="welcomeAlert" class="alert active">
        <div id="closeWelcome" class="close">
          <div class="bar-one"></div>
          <div class="bar-two"></div>
        </div>
        <h2>Welcome</h2><br><br>
        <p id="welcomeMsg"></p>
      </div>


      <div id="inactiveAlert" class="alert">
        <h2>Inactive Alert</h2><br><br>
        <p id="inactiveMsg">Your session is about to expire.</p>
        <br><br>
        <button id="stayButton" type="submit">Stay Logged In</button>
        <!-- <button id="loginAgainButton" type="submit">Login</button> -->
      </div>

      <!-- FOOTER -->
      <footer> Created by: Kayla D. Coleman </footer>

    </div>

    <script>
      let welcomeAlert = document.getElementById('welcomeAlert');
      let closeWelcome = document.getElementById('closeWelcome');
      let inactiveAlert = document.getElementById('inactiveAlert');
      let stayButton = document.getElementById('stayButton');
      // let loginAgainButton = document.getElementById('loginAgainButton');
      let welcomeMsg = document.getElementById('welcomeMsg');
      let returningUser = {{user.email_confirmed|lower}};

      closeWelcome.addEventListener('click', function(){
        welcomeAlert.classList.remove('active');
      })

      function showWelcomeMessage() {
        if (!returningUser) {
          newUserMsg = "Welcome " + "{{user.first_name}}" +
          "! We're so glad you decided to explore the land of Kay. We sent a confirmation email to "
          + "{{user.email}}" + ". <br><br> Please confirm your account."
          welcomeMsg.innerHTML = newUserMsg;
        } else {
          returningUserMsg = "Welcome back " + "{{user.first_name}}" +
          "! Check out what's new since your last time here. Happy exploring!"
          welcomeMsg.textContent = returningUserMsg;
        }
      }

      var inactiveTime;
      var inactiveInterval;
      var events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'onclick'];

      events.forEach(function(name) {
       document.addEventListener(name, resetTimer, true);
      });

      function logout() {
        inactiveAlert.classList.add('active');
      }

      function resetTimer() {
        clearTimeout(inactiveTime);
        inactiveTime = setTimeout(logout, 1000*60*4);
      }

      stayButton.addEventListener('click', function(){
        window.location.href = "{% url 'login:home' user.id %}";
      })

      // loginAgainButton.addEventListener('click', function(){
      //   window.location.href = "{% url 'login:index' %}";
      // })

    </script>

  </body>
</html>
